<script>
    var email = Cookies.get('friend');
    window.history.pushState("", "", "/main.html?w=messages&email=" + email);
    getMessages();

    function getMessages() {
        $.ajax({
            url: URLbase + "/messages?email=" + email,
            type: "GET",
            data: {},
            dataType: 'json',
            headers: {"token": token},
            success: function (res) {
                var messages = res;
                loadMessages(messages);
            },
            error: function (error) {
                $("main").load("widget-login.html");
            }
        });
    }

    function loadMessages(messages) {
        $("main").empty();
        $("main").append("<h1>Chat con <span id=\"friend\"></span></h1>");
        $('#friend').text(email);
        for (var i = 0; i < messages.length; i++) {
            if (messages[i].receiver == email) {
                $("main").append("<div class='containerChat'>" +
                    "<p class='text-right'>" + messages[i].sender + "</p>" +
                    "<p class='text-right'>" + messages[i].message + "</p>" +
                    "<span class='time-right'>" + messages[i].date + "</span>" +
                    "</div>");
            }
            else {
                $("main").append("<div class='containerChat '>" +
                    "<p class='text-left'>" + messages[i].sender + "</p>" +
                    "<p class='text-left'>" + messages[i].message + "</p>" +
                    "<span class='time-left'>" + messages[i].date + "</span>" +
                    "</div>");
            }

        }
    }
    setInterval(function () {
        getMessages();
    }, 5000);
</script>